# 最適化パラメータの解釈

## 概要

最適化結果（最良値: 4.8551）から得られたパラメータの解釈と、それらがどのように銘柄選定に影響するかを説明します。

---

## 1. Core Score（基本スコア）の重みパラメータ

### 1.1 重みの構成

```
core_score = w_quality × quality_score
           + w_value × value_score
           + w_growth × growth_score
           + w_record_high × record_high_score
           + w_size × size_score
```

### 1.2 最適化結果の重み

| パラメータ | 値 | 割合 | 解釈 |
|-----------|-----|------|------|
| **w_value** | **0.3008** | **30.08%** | **最重要** - バリュー投資を重視 |
| w_quality | 0.2245 | 22.45% | 品質（ROE）を重視 |
| w_size | 0.1604 | 16.04% | 時価総額（大型株を好む） |
| w_growth | 0.1006 | 10.06% | 成長性は控えめに評価 |
| w_record_high | 0.0609 | 6.09% | 最高値更新予想は補助的 |

### 1.3 パラメータ重要度の観点

**重要度とは**
- パラメータの値（重み）: スコア計算における各要素の寄与度
- パラメータ重要度: そのパラメータを変更したときの目的関数への影響度

**パラメータ重要度ランキング（Optuna分析結果）**

| 順位 | パラメータ | 重要度 | 値（重み） | 解釈 |
|------|-----------|--------|-----------|------|
| **1** | **w_record_high** | **0.70** | 0.0609 (6.09%) | **圧倒的に重要** - わずかな変更で大きな影響 |
| 2 | w_value | 0.12 | 0.3008 (30.08%) | 重要 - バリュー投資の基盤 |
| 3 | w_growth | 0.07 | 0.1006 (10.06%) | 中程度の重要度 |
| 4 | bb_z_base | 0.05 | -1.41 | Entry Scoreの閾値 |
| 5 | w_forward_per | 0.02 | 0.4825 (48.25%) | 低い重要度 |
| 6以下 | その他 | <0.01 | - | 重要度は低い |

### 1.4 重要な発見

**w_record_highの重要性（重要度0.70）**
- 重みは6.09%と小さいが、**重要度は0.70と圧倒的に高い**
- このパラメータを少し変更するだけで、目的関数の値が大きく変わる
- **「最高値更新予想」が戦略の成否を左右する重要な要素**
- 重みが小さいにもかかわらず、この要素の有無がパフォーマンスに大きく影響

**w_valueの安定性（重要度0.12）**
- 重みは30.08%と最大だが、重要度は0.12と比較的低い
- これは、w_valueの最適値が比較的安定していることを示す
- 少し変更しても大きな影響はない（最適値の周辺が平ら）

**w_growthの重要性（重要度0.07）**
- 重みは10.06%と控えめだが、重要度は0.07と中程度
- 成長性の評価方法がパフォーマンスに影響を与える

**bb_z_baseの重要性（重要度0.05）**
- Entry Scoreの閾値パラメータ
- モメンタム戦略のエントリータイミングに影響

### 1.5 解釈

**バリュー投資が最重要（30.08%）**
- 最適化結果は「割安な銘柄を選ぶ」戦略を支持
- 成長性（10.06%）よりも価値（30.08%）を重視
- これは「割安な大型株で、適度な成長性と品質を持つ銘柄」を選ぶ戦略

**品質（ROE）も重要（22.45%）**
- 単に安いだけでなく、収益性の高い銘柄を選ぶ
- ROEが高い銘柄を優先

**大型株を好む（16.04%）**
- 時価総額が大きい銘柄を優先
- 流動性と安定性を重視

**最高値更新予想の重要性（重要度0.70）**
- 重みは6.09%と小さいが、**重要度は0.70と圧倒的に高い**
- この要素の有無が戦略の成否を左右する
- **「最高値更新予想がある銘柄」を選ぶことが、パフォーマンス向上の鍵**

---

## 2. Value Score（バリュースコア）の内訳

### 2.1 計算式

```
value_score = w_forward_per × (1 - forward_per_pct)
            + w_pbr × (1 - pbr_pct)
```

- `forward_per_pct`: 業種内での予想PERのパーセンタイル（低いほど高スコア）
- `pbr_pct`: 業種内でのPBRのパーセンタイル（低いほど高スコア）

### 2.2 最適化結果

| パラメータ | 値 | 解釈 |
|-----------|-----|------|
| w_forward_per | 0.4825 (48.25%) | 予想PERを重視 |
| w_pbr | 0.5175 (51.75%) | PBRをやや重視 |

### 2.3 解釈

**PBRと予想PERをほぼ同等に評価**
- PBRがやや重視（51.75% vs 48.25%）
- 業種内で割安な銘柄を選ぶ
- 予想PERとPBRの両方で評価することで、より正確なバリュー評価を実現

---

## 3. Entry Score（エントリースコア）パラメータ

### 3.1 計算式

各期間（20日、60日、90日）で以下を計算し、最大値を採用：

```
bb_score = clip((BB_Z-score - bb_z_base) / (bb_z_max - bb_z_base), 0, 1)
rsi_score = clip((RSI - rsi_base) / (rsi_max - rsi_base), 0, 1)

entry_score_period = (bb_weight × bb_score + rsi_weight × rsi_score) / (bb_weight + rsi_weight)
entry_score = max(entry_score_20d, entry_score_60d, entry_score_90d)
```

### 3.2 最適化結果

| パラメータ | 値 | 解釈 |
|-----------|-----|------|
| **bb_weight** | **0.6233 (62.33%)** | **ボリンジャーバンドを重視** |
| rsi_weight | 0.3767 (37.67%) | RSIは補助的 |
| rsi_base | 44.64 | RSIが44.64以上でスコア開始 |
| rsi_max | 78.72 | RSIが78.72で最大スコア |
| bb_z_base | -1.41 | BB Z-scoreが-1.41以上でスコア開始 |
| bb_z_max | 2.50 | BB Z-scoreが2.50で最大スコア |

### 3.3 解釈

**順張り戦略（モメンタム）**
- RSIが44.64以上（中立的な強気相場）でスコアが始まる
- RSIが78.72（強気相場）で最大スコア
- BB Z-scoreが-1.41以上（下位バンドより上）でスコアが始まる
- BB Z-scoreが2.50（上位バンド付近）で最大スコア

**ボリンジャーバンドを重視（62.33%）**
- 価格のトレンド（ボリンジャーバンド）をRSI（モメンタム）よりも重視
- これは「価格が上昇トレンドにある銘柄」を選ぶ戦略

**選ばれる銘柄の特徴**
- 価格が上昇トレンドにある（BB Z-score > -1.41、できれば > 0）
- モメンタムがある（RSI > 44.64、できれば > 60）
- **「割安で、上昇トレンドにある大型株」**を選ぶ

---

## 4. フィルタ条件

### 4.1 最適化結果

| パラメータ | 値 | 解釈 |
|-----------|-----|------|
| roe_min | 0.0711 (7.11%) | ROEが7.11%以上 |
| liquidity_quantile_cut | 0.2642 (26.42%) | 下位26.42%の流動性の低い銘柄を除外 |

### 4.2 解釈

**緩めのROE基準（7.11%）**
- 従来の10%より緩い基準
- より多くの銘柄を候補に含める
- バリュー重視のため、ROEがやや低くても割安なら選ぶ

**流動性フィルタ（下位26.42%を除外）**
- 流動性の低い銘柄を除外
- 取引しやすい銘柄を選ぶ
- 大型株重視と整合性がある

---

## 5. 選定プロセス

### 5.1 選定フロー

```
1. フィルタ適用
   - 流動性: 下位26.42%を除外
   - ROE: 7.11%以上

2. Core Scoreでランキング
   - 上位80銘柄をプールに選定

3. Entry Scoreで再ソート
   - Entry Score → Core Score の順でソート
   - 上昇トレンドにある銘柄を優先

4. セクター制限
   - 各セクター最大4銘柄まで

5. 最終選定
   - 20-30銘柄を選定
```

### 5.2 選ばれる銘柄の特徴

**基本要件**
- ✅ ROE 7.11%以上
- ✅ 流動性が中位以上（下位26.42%を除外）
- ✅ 業種内で割安（forward_per、pbrが低い）
- ✅ 時価総額が大きい（大型株）

**追加要件（Entry Score）**
- ✅ 価格が上昇トレンド（BB Z-score > -1.41、できれば > 0）
- ✅ モメンタムがある（RSI > 44.64、できれば > 60）

**選定される銘柄のイメージ**
- 大型のバリュー株で、上昇トレンドにある銘柄
- 例：業種内で割安な大型株で、最近価格が上昇している銘柄

---

## 6. 戦略の特徴

### 6.1 戦略のタイプ

**「バリュー×モメンタム」戦略**
- バリュー投資（30.08%）を基盤に
- モメンタム（Entry Score）でタイミングを最適化
- 大型株（16.04%）で安定性を確保

### 6.2 最適化結果の意味

**バックテスト結果**
- 平均超過リターン: 4.52%（TOPIX比）
- 最適化目的関数値: 4.8551

**この戦略が有効な理由**
1. **バリュー投資**: 割安な銘柄を選ぶことで、下振れリスクを抑制
2. **モメンタム**: 上昇トレンドにある銘柄を選ぶことで、タイミングを最適化
3. **大型株**: 流動性と安定性を確保
4. **品質**: ROEが高い銘柄を選ぶことで、収益性を確保

---

## 7. パラメータの相互作用

### 7.1 Core ScoreとEntry Scoreの関係

- **Core Score**: 長期的な投資価値（バリュー、品質、成長性）
- **Entry Score**: 短期的なエントリータイミング（モメンタム）

**選定プロセス**
1. Core Scoreで「投資価値の高い銘柄」を選ぶ
2. Entry Scoreで「今が買い時」の銘柄を優先

**結果**
- 投資価値が高く、かつ上昇トレンドにある銘柄を選ぶ
- これにより、バリュー投資とモメンタム投資の両方の利点を活かす

### 7.2 重みのバランス

**バリュー重視（30.08%）**
- 割安な銘柄を選ぶことで、下振れリスクを抑制
- 成長性（10.06%）よりも価値を重視

**品質重視（22.45%）**
- ROEが高い銘柄を選ぶことで、収益性を確保
- 単に安いだけでなく、質の高い銘柄を選ぶ

**大型株重視（16.04%）**
- 時価総額が大きい銘柄を選ぶことで、流動性と安定性を確保

### 7.3 パラメータ重要度から見た戦略の特徴

**重要度が高いパラメータ（調整が効果的）**

1. **w_record_high（重要度0.70）**
   - 最高値更新予想の重みを調整すると、パフォーマンスが大きく変わる
   - この要素の有無が戦略の成否を左右する
   - **推奨**: このパラメータの最適値を見つけることが最重要

2. **w_value（重要度0.12）**
   - バリュー投資の重みを調整すると、パフォーマンスに影響
   - ただし、最適値は比較的安定している

3. **w_growth（重要度0.07）**
   - 成長性の重みを調整すると、パフォーマンスに影響
   - バリュー投資とのバランスが重要

4. **bb_z_base（重要度0.05）**
   - Entry Scoreの閾値を調整すると、エントリータイミングが変わる
   - モメンタム戦略の精度に影響

**重要度が低いパラメータ（調整の効果は限定的）**

- **w_quality, w_size, roe_min, liquidity_quantile_cut**（重要度<0.01）
- これらのパラメータを調整しても、パフォーマンスへの影響は小さい
- 現在の最適値の周辺で、目的関数が比較的平ら
- ただし、これらのパラメータは戦略の基盤を形成しているため、重要

**パラメータ調整の優先順位**

1. **最優先**: w_record_high（重要度0.70）
   - このパラメータの最適値を見つけることが最重要
   - わずかな変更で大きな影響がある

2. **次に優先**: w_value, w_growth（重要度0.12, 0.07）
   - バリュー投資と成長性のバランスを調整

3. **補助的**: bb_z_base（重要度0.05）
   - Entry Scoreの閾値を微調整

4. **その他**: 重要度が低いパラメータは、現在の最適値で維持

---

## 8. まとめ

### 8.1 最適化結果が示す戦略

**「割安な大型株で、上昇トレンドにある銘柄」を選ぶ戦略**

1. **バリュー投資を基盤**（30.08%）
   - 業種内で割安な銘柄を選ぶ
   - PBRと予想PERの両方で評価

2. **品質を重視**（22.45%）
   - ROEが高い銘柄を選ぶ
   - 最低7.11%のROEを要求

3. **大型株を好む**（16.04%）
   - 時価総額が大きい銘柄を優先
   - 流動性と安定性を確保

4. **モメンタムでタイミング最適化**
   - 上昇トレンドにある銘柄を優先
   - ボリンジャーバンドを重視（62.33%）

5. **最高値更新予想が鍵**（重要度0.70）
   - 重みは6.09%と小さいが、**重要度は0.70と圧倒的に高い**
   - **「最高値更新予想がある銘柄」を選ぶことが、パフォーマンス向上の鍵**
   - この要素の有無が戦略の成否を左右する

### 8.2 選ばれる銘柄の特徴

- ✅ **最高値更新予想がある**（最重要 - 重要度0.70）
- ✅ 業種内で割安（forward_per、pbrが低い）
- ✅ ROEが高い（7.11%以上、できれば10%以上）
- ✅ 時価総額が大きい（大型株）
- ✅ 価格が上昇トレンド（BB Z-score > -1.41）
- ✅ モメンタムがある（RSI > 44.64）

**特に重要な特徴**
- **最高値更新予想がある銘柄**を選ぶことが、パフォーマンス向上の鍵
- この要素の有無が戦略の成否を左右する（重要度0.70）

### 8.3 この戦略の強み

1. **リスク管理**: バリュー投資と大型株重視により、下振れリスクを抑制
2. **タイミング最適化**: モメンタムにより、エントリータイミングを最適化
3. **収益性**: 品質重視により、収益性の高い銘柄を選ぶ
4. **実用性**: 流動性フィルタにより、実際に取引しやすい銘柄を選ぶ
5. **最高値更新予想の活用**: 最高値更新予想がある銘柄を選ぶことで、パフォーマンスを大幅に向上（重要度0.70）

### 8.4 パラメータ重要度から見た戦略の本質

**戦略の本質**
- パラメータ重要度の分析から、**「最高値更新予想がある銘柄」を選ぶことが、戦略の成否を左右する**
- 重みは6.09%と小さいが、この要素の有無がパフォーマンスに大きく影響（重要度0.70）
- これは、**「成長期待が高く、かつ割安な銘柄」**を選ぶ戦略であることを示唆

**パラメータ調整の指針**
- 将来の最適化では、**w_record_highの探索範囲を広げる**ことを推奨
- このパラメータの最適値を見つけることが、パフォーマンス向上の鍵
- w_value、w_growthも重要だが、最適値は比較的安定している

---

## 9. 注意事項

### 9.1 過学習のリスク

- 最適化は2022-2025年のデータに基づいている
- 将来の市場環境が変わると、パフォーマンスが低下する可能性がある

### 9.2 市場環境への依存

- この戦略は「バリュー×モメンタム」が有効な市場環境で機能する
- 市場環境が変わると、パラメータの再最適化が必要になる可能性がある

### 9.3 継続的なモニタリング

- 定期的にパフォーマンスを確認し、必要に応じてパラメータを調整
- 市場環境の変化に応じて、戦略を見直す


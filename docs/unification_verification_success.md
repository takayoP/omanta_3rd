# 統一確認成功：compare側とoptimize側でportfolio_hashが一致

## 実行日時

2026年1月11日

## 確認内容

同じparamsファイル（`params_operational_24M_lambda0.00_best_20260111_154617.json`）を使用して、`rebalance_date` 2023-01-31について、compare側とoptimize側の結果を比較しました。

## 確認結果

### ✅ すべての項目が一致

| 項目 | compare側 | optimize側 | 結果 |
|------|-----------|-----------|------|
| **params_hash** | `b1f763b3` | `b1f763b3` | ✅ 一致 |
| **portfolio_hash** | `458c5408` | `458c5408` | ✅ 一致 |
| **selected_codes** | `[1716, 621, 568, 512, 1669, 1245, 1828, 793, 1424, 744, 1555, 1667]` | `[1716, 621, 568, 512, 1669, 1245, 1828, 793, 1424, 744, 1555, 1667]` | ✅ 一致 |
| **weights** | `[0.0833, ...]` (12銘柄で1/12ずつ) | `[0.0833, ...]` (12銘柄で1/12ずつ) | ✅ 一致（等ウェイト） |
| **entry_date** | `2023-01-31` | `2023-01-31` | ✅ 一致 |
| **exit_date** | `2025-01-31` | `2025-01-31` | ✅ 一致 |
| **total_return_pct** | `64.27%` | `64.27%` | ✅ 一致 |
| **topix_return_pct** | `40.55%` | `40.55%` | ✅ 一致 |
| **annualized_excess_return_pct** | `9.60%` | `9.60%` | ✅ 一致 |

## 重要な確認点

### ✅ portfolio_hashが一致（これがゴール）

`portfolio_hash`: `458c5408` が両方で一致しています。

これは、compare側とoptimize側で**同じポートフォリオ（銘柄＋重み）**が生成されていることを意味します。

### ✅ 等ウェイトが正しく適用されている

`weights`が`[0.08333333333333333, ...]`（12銘柄で1/12 = 0.0833...ずつ）で、等ウェイトが正しく適用されています。

## 結論

**統一が成功しました。** compare側とoptimize側で同じparamsファイルを使用した結果、`portfolio_hash`が一致し、すべての項目が一致しています。

これにより、統一前の不一致（異なるポートフォリオが生成されていた）が解消され、等ウェイト戦略で統一されたことが確認できました。

## 次のステップ

統一前の最適化結果は「スコア加重戦略」を前提にしていた可能性があるため、**λ比較と本番再最適化を再実行**することを推奨します。

1. **λ比較（compare_lambda_penalties.py）**: 等ウェイト戦略での最適なλ値を決定
2. **本番再最適化（reoptimize_all_candidates.py）**: 等ウェイト戦略で最適化されたパラメータを使用


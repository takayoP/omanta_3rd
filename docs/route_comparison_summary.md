# 2023-01-31の両ルート比較結果（まとめ）

## 重要な発見

### ⚠️ **ポートフォリオが完全に異なる**

| 項目 | optimize側 | compare側 | 差 |
|------|-----------|----------|-----|
| **銘柄コード** | [129845, 129600, ...] | [1661, 512, ...] | **完全に異なる** |
| **重み** | 不均等（7.94%～8.80%） | 等権重（8.33%） | **異なる** |
| **total_return_pct** | **50.74%** | **24.61%** | **+26.13%pt** |
| **excess_return_pct** | **10.19%** | **-15.94%** | **+26.13%pt** |
| **年率超過リターン** | **4.22%** | **-6.92%** | **+11.14%pt** |

### 原因

**パラメータが異なります。**

#### optimize側（最新の最適化結果）
- 最良パラメータ（2026-01-11 15:46:17の最適化結果）
- `w_quality`: 0.499, `w_value`: 0.113, `w_size`: 0.384, `roe_min`: **0.139**, etc.

#### compare側（以前の最適化結果）
- パラメータ（`params_operational_24M_lambda0.00_20260111.json`）
- `w_quality`: 0.129, `w_value`: **0.717**, `w_size`: 0.065, `roe_min`: **0.002**, etc.

**主な違い:**
- `w_quality`: 0.499 vs 0.129（約4倍）
- `w_value`: 0.113 vs 0.717（約6倍の違い）
- `w_size`: 0.384 vs 0.065（約6倍）
- `roe_min`: **0.139 vs 0.002**（約70倍）

## 結論

### ChatGPTの指摘通り、**ポートフォリオが一致しない**

これは、`test_mean_excess_return_pct`と`avg_annualized_excess_return_pct`の差の原因が、「集約方法の違い」ではなく、「**ポートフォリオ生成の違い（パラメータの違い）**」であることを示しています。

### ただし、これは「バグ」ではなく「比較対象の違い」

両者は**異なるパラメータ**を使用しているため、ポートフォリオが異なるのは当然です。

## 次のステップ

### 同じパラメータで比較する必要がある

ChatGPTの指摘通り、同じパラメータで比較する必要があります。

**推奨アプローチ:**
- compare側で最新の最適化結果のパラメータを使用
- 最新の最適化結果の最良パラメータをパラメータファイルに保存
- そのパラメータファイルを使用してcompare側を実行

これにより、`test_mean_excess_return_pct`と`avg_annualized_excess_return_pct`が同じパラメータで計算され、適切な比較が可能になります。





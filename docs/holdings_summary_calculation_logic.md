# Holdings Summary 計算ロジック

## TOPIXリターンの計算方法

保有銘柄全体のTOPIXリターンは、各銘柄の保有期間に応じたTOPIXリターンを投資額で重み付き平均して計算します。

### 計算ステップ

#### 1. 各銘柄のTOPIXリターンを計算

**保有中銘柄の場合：**
- 購入日のTOPIX始値を取得
- 評価日のTOPIX終値を取得
- TOPIXリターン = (TOPIX終値 - TOPIX始値) / TOPIX始値 × 100

**売却済み銘柄の場合：**
- 購入日のTOPIX始値を取得
- 売却日のTOPIX終値を取得
- TOPIXリターン = (TOPIX終値 - TOPIX始値) / TOPIX始値 × 100

#### 2. 投資額で重み付け

各銘柄の投資額 = 購入単価 × 株数

重み = 各銘柄の投資額 / 総投資額

#### 3. ポートフォリオ全体のTOPIXリターン

```
TOPIX_return = Σ(各銘柄の投資額 × 各銘柄のTOPIXリターン) / 総投資額
             = Σ(各銘柄の重み × 各銘柄のTOPIXリターン)
```

### 例

以下のポートフォリオを例にします：

| 銘柄 | 購入日 | 購入単価 | 株数 | 投資額 | 評価日 | TOPIXリターン |
|------|--------|----------|------|--------|--------|---------------|
| A    | 2025-01-01 | 1,000円 | 100株 | 100,000円 | 2025-12-28 | 5.0% |
| B    | 2025-06-01 | 2,000円 | 50株 | 100,000円 | 2025-12-28 | 3.0% |
| C    | 2025-03-01 | 1,500円 | 66.67株 | 100,000円 | 2025-10-01（売却済み） | 2.0% |

総投資額 = 300,000円

**計算：**
```
TOPIX_return = (100,000 / 300,000) × 5.0% + (100,000 / 300,000) × 3.0% + (100,000 / 300,000) × 2.0%
             = (1/3) × 5.0% + (1/3) × 3.0% + (1/3) × 2.0%
             = 1.67% + 1.0% + 0.67%
             = 3.33%
```

### ポートフォリオ全体のリターンとの比較

ポートフォリオ全体のリターン = (総含み損益 + 総実現損益) / 総投資額 × 100

超過リターン = ポートフォリオリターン - TOPIXリターン

### 注意点

- 各銘柄の保有期間が異なるため、単純な期間平均ではなく、投資額で重み付けした平均を使用します
- 売却済み銘柄も、その銘柄の保有期間（購入日～売却日）でのTOPIXリターンを計算に含めます
- これにより、実際の投資行動に基づいた正確なTOPIXとの比較が可能になります


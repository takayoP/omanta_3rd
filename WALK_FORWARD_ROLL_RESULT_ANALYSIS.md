# Walk-Forward Analysis (Roll方式) 結果評価レポート

## 📊 実行概要

- **期間**: 2020-01-01 ～ 2025-12-31
- **ホライズン**: 12ヶ月
- **Fold数**: 4個（3個の中間fold + 1個の最終ホールドアウト）
- **最適化試行回数**: 30 trials/fold
- **評価終了年ホールドアウト**: 2025年

---

## 📈 各Foldの結果

### Fold 1: Train(2020) → Test(2021)
- **年率超過リターン（平均）**: **+3.03%** ✅
- **年率超過リターン（中央値）**: +3.93%
- **勝率**: **75.0%** ✅
- **ポートフォリオ数**: 12
- **評価**: **良好** - 2021年は良好な成績

### Fold 2: Train(2020-2021) → Test(2022)
- **年率超過リターン（平均）**: **-12.47%** ❌
- **年率超過リターン（中央値）**: -14.91%
- **勝率**: **8.3%** ❌
- **ポートフォリオ数**: 12
- **評価**: **不良** - 2022年は大幅なマイナス（市場環境の影響が大きい可能性）

### Fold 3: Train(2020-2022) → Test(2023)
- **年率超過リターン（平均）**: **-9.33%** ❌
- **年率超過リターン（中央値）**: -6.50%
- **勝率**: **0.0%** ❌
- **ポートフォリオ数**: 12
- **評価**: **不良** - 2023年もマイナス（勝率0%は深刻）

### Fold 4 (最終ホールドアウト): Train(2020-2023) → Test(2024)
- **年率超過リターン（平均）**: **+5.45%** ✅
- **年率超過リターン（中央値）**: +2.96%
- **勝率**: **66.7%** ✅
- **ポートフォリオ数**: 12
- **評価**: **良好** - 最終ホールドアウトで良好な成績

---

## 📊 全体サマリー統計

### 年率超過リターン（平均）の統計
- **平均**: -3.33%
- **中央値**: -3.15%
- **最小**: -12.47% (Fold 2)
- **最大**: +5.45% (Fold 4 - 最終ホールドアウト)
- **P10**: -11.52%

### 年率超過リターン（中央値）の平均
- **平均**: -3.63%

### 勝率の統計
- **平均**: 37.5%
- **最小**: 0.0% (Fold 3)

---

## ✅ 良い点

1. **最終ホールドアウト（2024年）で良好な成績**
   - 年率超過リターン: +5.45%
   - 勝率: 66.7%
   - これは最も重要な結果（実際の運用に近い）

2. **Fold 1（2021年）も良好**
   - 年率超過リターン: +3.03%
   - 勝率: 75.0%

3. **パラメータの一貫性**
   - 各foldで異なるパラメータが最適化されている
   - 最終ホールドアウトのパラメータが選択されている

---

## ⚠️ 懸念点

1. **Fold 2（2022年）とFold 3（2023年）で大幅なマイナス**
   - Fold 2: -12.47%（勝率8.3%）
   - Fold 3: -9.33%（勝率0%）
   - **市場環境の影響が大きい可能性**（2022-2023年は市場が悪かった）

2. **平均年率超過リターンがマイナス**
   - 全体平均: -3.33%
   - ただし、最終ホールドアウトは+5.45%で良好

3. **勝率のばらつきが大きい**
   - 平均: 37.5%
   - 最小: 0.0%（Fold 3）
   - 最大: 75.0%（Fold 1）

4. **Fold数が予想より少ない**
   - 予想: 5個（2021, 2022, 2023, 2024, 2025）
   - 実際: 4個（2021, 2022, 2023, 2024）
   - 2025年の評価終了年が生成されなかった可能性

---

## 🔍 詳細分析

### パラメータの変動

各foldで最適化されたパラメータが大きく異なる：

| パラメータ | Fold 1 | Fold 2 | Fold 3 | Fold 4 (Holdout) |
|-----------|--------|--------|--------|------------------|
| w_quality | 0.107 | 0.430 | 0.256 | 0.246 |
| w_growth | 0.187 | 0.121 | 0.131 | 0.076 |
| w_value | 0.391 | 0.117 | 0.448 | 0.448 |
| w_forward_per | 0.423 | 0.716 | 0.895 | 0.739 |
| bb_weight | 0.335 | 0.512 | 0.864 | 0.784 |

**解釈**:
- パラメータがfoldごとに大きく変動している
- これは「市場環境に応じて最適パラメータが変わる」ことを示唆
- または「過学習の可能性」も示唆

### Train期間の拡大による影響

- **Fold 1**: Train 12日（1年）→ Test 12日
- **Fold 2**: Train 24日（2年）→ Test 12日
- **Fold 3**: Train 36日（3年）→ Test 12日
- **Fold 4**: Train 48日（4年）→ Test 12日

**観察**:
- Train期間が長くなるほど、Test成績が改善する傾向は見られない
- Fold 4（最終ホールドアウト）が最も良い成績

---

## 💡 解釈と推奨事項

### 1. 最終ホールドアウトの結果を重視

**最終ホールドアウト（2024年）の結果が最も重要**です：
- 年率超過リターン: +5.45%
- 勝率: 66.7%
- これは実際の運用に最も近い評価

### 2. 2022-2023年のマイナスについて

**市場環境の影響を考慮**：
- 2022-2023年は市場全体が悪かった可能性
- TOPIXとの比較（超過リターン）なので、市場の影響はある程度排除されている
- ただし、戦略自体が市場環境に弱い可能性もある

### 3. パラメータの安定性

**運用パラメータの選択**：
- `params_operational.json`に保存されているパラメータ（Fold 4のパラメータ）を使用
- ただし、他のfoldでも評価して、安定性を確認することを推奨

### 4. 追加検証の推奨

1. **他のfoldのパラメータでも2024年を評価**
   - Fold 1, 2, 3のパラメータで2024年を評価
   - パラメータの安定性を確認

2. **市場環境の分析**
   - 2022-2023年の市場環境を確認
   - TOPIXの動きと比較

3. **より長い期間での評価**
   - 可能であれば、より長い期間での評価を検討

---

## 📋 結論

### 総合評価: ⚠️ **慎重に評価が必要**

**良い点**:
- ✅ 最終ホールドアウト（2024年）で良好な成績（+5.45%）
- ✅ Fold 1（2021年）も良好（+3.03%）

**懸念点**:
- ⚠️ Fold 2（2022年）とFold 3（2023年）で大幅なマイナス
- ⚠️ 全体平均がマイナス（-3.33%）
- ⚠️ パラメータの変動が大きい

**推奨事項**:
1. **最終ホールドアウトの結果を重視**（最も重要）
2. **市場環境の影響を考慮**（2022-2023年）
3. **追加検証を実施**（他のfoldのパラメータでも評価）
4. **運用パラメータは`params_operational.json`を使用**

---

## 📁 生成されたファイル

1. **walk_forward_longterm_12M_roll_evalYear2025.json**: 詳細結果
2. **params_operational.json**: 運用パラメータ（Fold 4のパラメータ）
3. **params_by_fold.json**: 各foldのパラメータ一覧

---

## 🔄 次のステップ

1. **他のfoldのパラメータでも2024年を評価**
2. **市場環境の分析**
3. **より詳細な分析**（個別ポートフォリオの成績など）
4. **Week4の作業に進む**（Ranker + 説明）















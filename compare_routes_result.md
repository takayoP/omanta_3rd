# 2023-01-31の両ルート比較結果

## optimize側（calculate_longterm_performance）の結果

**デバッグ出力から取得:**
```json
{
  "rebalance_date": "2023-01-31",
  "entry_date": "2023-01-31",
  "exit_date": "2025-01-31",
  "selected_codes": [129845, 129600, 128461, 129843, 129844, 128797, 129314, 129301, 128881, 128332, 128816, 128614],
  "weights": [0.0879, 0.0864, 0.0860, 0.0855, 0.0838, 0.0837, 0.0822, 0.0821, 0.0818, 0.0813, 0.0795, 0.0793],
  "total_return_pct": 50.74%,
  "topix_return_pct": 40.55%,
  "excess_return_pct": 10.19%,
  "annualized_total_return_pct": 22.76%,
  "annualized_topix_return_pct": 18.54%,
  "annualized_excess_return_pct": 4.22%,
  "holding_years": 2.0014年
}
```

## compare側（run_backtest_with_params_file）の結果

**以前の実行結果から:**
- **選定銘柄**: 12銘柄
- **銘柄コード**: 1661, 512, 1425, 503, 1418, 1304, 1420, 137, 338, 895, 819, 793
- **重み**: 等権重（8.33%ずつ）
- **入口日**: 2023-01-31
- **出口日**: 2025-01-31
- **total_return_pct**: 24.61%
- **topix_return_pct**: 40.55%
- **excess_return_pct**: -15.94%
- **年率超過リターン**: -6.92%

## 比較結果

### ⚠️ **重要な発見: ポートフォリオが完全に異なる**

| 項目 | optimize側 | compare側 |
|------|-----------|----------|
| **銘柄コード** | [129845, 129600, ...] | [1661, 512, ...] |
| **重み** | 不均等（8.79%～7.93%） | 等権重（8.33%） |
| **total_return_pct** | **50.74%** | **24.61%** |
| **topix_return_pct** | 40.55% | 40.55% |
| **excess_return_pct** | **10.19%** | **-15.94%** |
| **年率超過リターン** | **4.22%** | **-6.92%** |

### 結論

**ポートフォリオが完全に異なります。** これは、両ルートで**異なるパラメータ**が使用されているか、**ポートフォリオ生成のタイミングが異なる**可能性があります。

## 次のステップ

1. **パラメータの確認**: compare側で使用したパラメータファイル（`params_operational_24M_lambda0.00_20260111.json`）と、optimize側で使用したパラメータ（最適化で見つかった最良パラメータ）が異なる可能性があります。

2. **パラメータの統一**: 両ルートで**同じパラメータ**を使用する必要があります。

3. **最適化結果のパラメータを確認**: 最新の最適化結果（`optimization_result_optimization_longterm_studyC_20260111_154617.json`）の最良パラメータを確認し、compare側のパラメータファイルと比較する必要があります。

## 重要な点

ChatGPTの指摘通り、**ポートフォリオが一致しない**ことが判明しました。これは、`test_mean_excess_return_pct`と`avg_annualized_excess_return_pct`の差の原因が、「集約方法の違い」ではなく、「ポートフォリオ生成の違い」である可能性が高いことを示しています。

ただし、optimize側は「最適化で見つかった最良パラメータ」を使用しているのに対し、compare側は「既存のパラメータファイル（lambda0.00の結果）」を使用している可能性があります。

同じパラメータで比較する必要があります。

